âœ… â‘  ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†UIï¼ˆadminç”¨ï¼‰
bash
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
app/
â””â”€â”€ admin-dashboard/
    â””â”€â”€ mail-template/
        â”œâ”€â”€ page.js                   # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¸€è¦§ç”»é¢
        â”œâ”€â”€ create/
        â”‚   â””â”€â”€ page.js               # æ–°è¦ä½œæˆï¼ˆJoditã‚¨ãƒ‡ã‚£ã‚¿ï¼‰
        â””â”€â”€ edit/
            â””â”€â”€ [id]/
                â””â”€â”€ page.js           # ç·¨é›†ç”»é¢ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ç·¨é›†ï¼‹ä¿å­˜ï¼‰
âœ… â‘¡ é…ä¿¡ç¢ºèªï¼†å®Ÿè¡ŒUI
perl
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
app/
â””â”€â”€ admin-dashboard/
    â””â”€â”€ news-send/
        â”œâ”€â”€ page.js                   # æœ¬æ—¥é…ä¿¡äºˆå®šä¸€è¦§ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆÃ—è¨˜äº‹ï¼‰
        â”œâ”€â”€ preview/
        â”‚   â””â”€â”€ [client_id]/
        â”‚       â””â”€â”€ page.js           # å„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸ã®å®Ÿéš›ã®é…ä¿¡å†…å®¹ç¢ºèª
        â””â”€â”€ send/
            â””â”€â”€ page.js               # é…ä¿¡å®Ÿè¡Œãƒœã‚¿ãƒ³ï¼ˆæ‰‹å‹•é…ä¿¡ or ãƒãƒƒãƒå‡¦ç†ï¼‰
âœ… â‘¢ APIãƒ«ãƒ¼ãƒˆ
bash
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
app/
â””â”€â”€ api/
    â””â”€â”€ mail-template/
        â”œâ”€â”€ create/route.js          # POST: æ–°è¦ãƒ†ãƒ³ãƒ—ãƒ¬ä¿å­˜
        â”œâ”€â”€ list/route.js            # GET: ä¸€è¦§å–å¾—
        â””â”€â”€ [id]/
            â”œâ”€â”€ get/route.js         # GET: è©³ç´°å–å¾—
            â”œâ”€â”€ update/route.js      # PATCH: æ›´æ–°
            â””â”€â”€ delete/route.js      # DELETE: å‰Šé™¤

    â””â”€â”€ news-send/
        â”œâ”€â”€ get-today-targets/route.js   # GET: ä»Šæ—¥é€ã‚‹å¯¾è±¡ä¸€è¦§
        â”œâ”€â”€ generate-html/route.js       # POST: ãƒ¡ãƒ¼ãƒ«HTMLç”Ÿæˆï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬+ã‚«ãƒ¼ãƒ‰ï¼‰
        â”œâ”€â”€ send-to-client/route.js      # POST: å€‹åˆ¥é€ä¿¡
        â””â”€â”€ send-batch/route.js          # POST: ä¸€æ‹¬é€ä¿¡
âœ… â‘£ å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒª
bash
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
lib/
â”œâ”€â”€ renderTemplate.js              # ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€å·®è¾¼å‡¦ç†ï¼ˆ{{$full_name}} ç­‰ï¼‰
â”œâ”€â”€ generateCardHTML.js           # è¨˜äº‹ãƒ‡ãƒ¼ã‚¿ â†’ HTMLã‚«ãƒ¼ãƒ‰å¤‰æ›
â”œâ”€â”€ sendMail.js                   # nodemailerã¾ãŸã¯SendGridé€ä¿¡å‡¦ç†
âœ… â‘¤ Supabase ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæœ€ä½é™2ã¤ï¼‰
email_templates

id, title, content, logo_url, created_by, created_at, updated_at

delivery_logs

id, client_id, article_id, sent_at, statusï¼ˆæˆåŠŸ/å¤±æ•—ï¼‰

âœ… æ¨å¥¨ä½œæ¥­é †ï¼ˆåˆæ—¥ï¼‰
mail-template/ UIï¼ˆä¸€è¦§ï¼‹createï¼‹editï¼‰

email_templates ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆï¼ˆSupabase UIã§OKï¼‰

renderTemplate.jsï¼ˆå¤‰æ•°ç½®æ›å‡¦ç†ï¼‰

generateCardHTML.jsï¼ˆä»®ã®ã‚«ãƒ¼ãƒ‰HTMLï¼‰

sendMail.jsï¼ˆé€ä¿¡APIï¼‰

news-send/page.jsï¼ˆå½“æ—¥å¯¾è±¡ä¸€è¦§è¡¨ç¤ºï¼‰

â˜…â˜…
âš ï¸ ä¿®æ­£ãƒ»è¿½åŠ ã™ã¹ãç‚¹
â‘  delivery_logs.client_id â†’ user_id ã«æ˜ç¢ºåŒ–ï¼ˆusersãƒ†ãƒ¼ãƒ–ãƒ«ä¸»è»¸ã«ï¼‰
READMEã§ã¯ã€Œclient_idã€ã¨è¨˜è¼‰

å®Ÿè£…ã¨æ–¹é‡ã§ã¯ user_idï¼ˆauth.users.idï¼‰ã‚’ä½¿ç”¨

âœ… READMEã« client_id â†’ user_id ã®ä¿®æ­£ãŒå¿…è¦

â‘¡ æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã®ã€Œå¯è¦–åŒ–ãƒ»é…ä¿¡ãƒ•ãƒ©ã‚°ç®¡ç†ã€ãŒæ˜æ–‡åŒ–ã•ã‚Œã¦ã„ãªã„
READMEã«ã¯ jnet_articles_public ã«é–¢ã™ã‚‹æ¬¡ã®æ§‹æˆãŒæ›¸ã‹ã‚Œã¦ã„ã¾ã›ã‚“ï¼š

visible: booleanï¼ˆclientè¡¨ç¤ºè¨±å¯ï¼‰

send_today: booleanï¼ˆæœ¬æ—¥é…ä¿¡è¨±å¯ï¼‰

admin_memo: textï¼ˆå†…éƒ¨ãƒ¡ãƒ¢ï¼‰

âœ… ã“ã‚Œã‚‰ã‚’READMEã«è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€adminä¸­å¿ƒé‹ç”¨ã®å±•æœ›ã¨æ•´åˆã—ã¾ã™ã€‚

âœ… â‘¥ æ§‹é€ åŒ–è¨˜äº‹ã®åˆ¶å¾¡ã‚«ãƒ©ãƒ ï¼ˆadminãŒç®¡ç†ï¼‰

jnet_articles_public ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä»¥ä¸‹ã®ã‚«ãƒ©ãƒ ã‚’è¿½åŠ ï¼š

- visible (boolean): ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«è¡¨ç¤ºã™ã‚‹ã‹ã©ã†ã‹
- send_today (boolean): æœ¬æ—¥ã®é…ä¿¡å¯¾è±¡ã¨ã—ã¦æ‰±ã†ã‹
- admin_memo (text): ç®¡ç†ç”¨ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰

ã“ã‚Œã«ã‚ˆã‚Šã€adminãŒæ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã‚’ç²¾æŸ»ãƒ»å…¬é–‹åˆ¶å¾¡ãƒ»é…ä¿¡è¨±å¯ã™ã‚‹é‹ç”¨ãŒå¯èƒ½ã€‚
client-dashboard å´ã§ã¯ visible=true ã®ã¿ã‚’è¡¨ç¤ºã€‚

â˜…â˜…

ğŸ“˜ READMEï½œãƒ¡ãƒ¼ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç† & è‡ªå‹•é…ä¿¡æ§‹æˆï¼ˆ2025/05/10 å®Œæˆï¼‰
âœ… æ¦‚è¦
ã“ã®æ©Ÿèƒ½ã¯ã€ç®¡ç†è€…ãŒæ§‹é€ åŒ–ã•ã‚ŒãŸåŠ©æˆé‡‘ãƒ»è£œåŠ©é‡‘è¨˜äº‹ã‚’å…ƒã«ã€
æ¡ä»¶ã«ãƒãƒƒãƒã™ã‚‹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸ ä¸€æ‹¬ãƒ¡ãƒ¼ãƒ«é…ä¿¡ ã‚’è¡Œã†ãŸã‚ã®ä»•çµ„ã¿ã§ã™ã€‚

ğŸ“¤ é…ä¿¡å¯¾è±¡ã¯è‡ªå‹•ã§ãƒãƒƒãƒãƒ³ã‚°

âœ‰ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯è‡ªç”±ã«ä½œæˆãƒ»ç·¨é›†

ğŸ“… ç®¡ç†ç”»é¢ã‹ã‚‰ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§é…ä¿¡å¯èƒ½

ğŸ—‚ ãƒ­ã‚°ã¯DBã«ä¿å­˜ã—ã€å†é€ã‚’é˜²æ­¢

ğŸ—‚ï¸ æ§‹ç¯‰æ¸ˆã¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ
bash
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
app/
â”œâ”€ admin-dashboard/
â”‚  â””â”€ mail-template/
â”‚     â”œâ”€ page.js                # ä¸€è¦§è¡¨ç¤º
â”‚     â”œâ”€ create/page.js         # æ–°è¦ä½œæˆãƒ•ã‚©ãƒ¼ãƒ 
â”‚     â””â”€ edit/[id]/page.js      # ç·¨é›†ãƒ»å‰Šé™¤ãƒšãƒ¼ã‚¸

â”œâ”€ api/
â”‚  â””â”€ mail-template/
â”‚     â”œâ”€ list/route.js          # ä¸€è¦§å–å¾—
â”‚     â”œâ”€ create/route.js        # æ–°è¦ä½œæˆ
â”‚     â””â”€ [id]/
â”‚         â”œâ”€ get/route.js       # å€‹åˆ¥å–å¾—
â”‚         â”œâ”€ update/route.js    # æ›´æ–°å‡¦ç†
â”‚         â””â”€ delete/route.js    # å‰Šé™¤å‡¦ç†

â”‚  â””â”€ news-send/
â”‚     â”œâ”€ get-today-targets/route.js   # æœ¬æ—¥ãƒãƒƒãƒãƒ³ã‚°å–å¾—
â”‚     â””â”€ send-today/route.js          # é…ä¿¡å®Ÿè¡Œï¼ˆSMTPï¼‰
âœ… å®Ÿè£…æ©Ÿèƒ½ä¸€è¦§
æ©Ÿèƒ½ã‚«ãƒ†ã‚´ãƒª	å®Ÿè£…å†…å®¹
ğŸ“© ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†	ä¸€è¦§è¡¨ç¤ºãƒ»æ–°è¦ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤
ğŸ§  è¨˜äº‹ãƒãƒƒãƒãƒ³ã‚°	ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå±æ€§ï¼ˆæ¥­ç¨®ãƒ»åœ°åŸŸï¼‰ã¨è¨˜äº‹å†…å®¹ã®è‡ªå‹•ãƒãƒƒãƒ
ğŸ“¤ é…ä¿¡ç¢ºèª	æœ¬æ—¥å¯¾è±¡ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨è¨˜äº‹ã‚’ç®¡ç†ç”»é¢ã§ç¢ºèª
âœ‰ ãƒ¡ãƒ¼ãƒ«é€ä¿¡	SMTPï¼ˆValueserverï¼‰çµŒç”±ã§ä¸€æ‹¬é€ä¿¡
ğŸ—ƒ ãƒ­ã‚°ä¿å­˜	delivery_logs ã«é€ä¿¡å±¥æ­´ã‚’è¨˜éŒ²ï¼ˆå†é€é˜²æ­¢ï¼‰

âœ… ä½¿ç”¨ãƒ†ãƒ¼ãƒ–ãƒ«
ğŸ”¹ email_templates
ã‚«ãƒ©ãƒ å	å‹	èª¬æ˜
id	int	ãƒ†ãƒ³ãƒ—ãƒ¬IDï¼ˆPKï¼‰
title	text	ã‚¿ã‚¤ãƒˆãƒ«
content	text	æœ¬æ–‡ï¼ˆHTMLï¼‰
logo_url	text	ãƒ­ã‚´ç”»åƒURLï¼ˆä»»æ„ï¼‰
created_at	timestamp	ä½œæˆæ—¥æ™‚ï¼ˆè‡ªå‹•ï¼‰

ğŸ”¹ delivery_logs
ã‚«ãƒ©ãƒ å	å‹	èª¬æ˜
id	int	ãƒ­ã‚°IDï¼ˆPKï¼‰
user_id	uuid	å®›å…ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ID
article_id	int	å¯¾è±¡è¨˜äº‹ID
sent_at	timestamp	é…ä¿¡æ—¥æ™‚

âœ… è£œè¶³
ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ ç¾åœ¨1ç¨®é¡ã‚’å…±é€šä½¿ç”¨ï¼ˆå°†æ¥çš„ã«ã¯åˆ‡ã‚Šæ›¿ãˆå¯èƒ½ã«æ‹¡å¼µå¯ï¼‰

é…ä¿¡ã¯ ã€Œæœ¬æ—¥é€ä¿¡ãƒ•ãƒ©ã‚°ãŒç«‹ã£ã¦ãŠã‚Šã€ã‹ã¤æœªé€ä¿¡ã®çµ„ã¿åˆã‚ã›ã€ã®ã¿å¯¾è±¡

ç·¨é›†ç”»é¢ã§ã¯ å‰Šé™¤ãƒœã‚¿ãƒ³ä»˜ãã§ç®¡ç†è€…æ“ä½œãŒå®Œçµå¯èƒ½

Joditã‚¨ãƒ‡ã‚£ã‚¿ ã«ã‚ˆã‚ŠHTMLãƒ¡ãƒ¼ãƒ«ã‚’GUIã§æ§‹ç¯‰

âœ… ä»Šå¾Œã®æ‹¡å¼µå€™è£œ
æ©Ÿèƒ½	å†…å®¹
ğŸ§ª ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼	å®Ÿéš›ã®æœ¬æ–‡ã‚’äº‹å‰è¡¨ç¤º
â­ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬æŒ‡å®š	ä¸€è¦§ã§é¸æŠå¯èƒ½ã«
â° è‡ªå‹•croné€ä¿¡å¯¾å¿œ	å¤œé–“ãƒãƒƒãƒé…ä¿¡ãªã©

ğŸ å®Œäº†æ—¥
2025å¹´5æœˆ10æ—¥ï¼ˆåœŸï¼‰ 17:15 å®Œäº†
ï¼ˆé–‹ç™ºæœŸé–“ï¼šç´„1æ—¥ï¼‰


â˜…â˜…
ğŸ“ å°†æ¥çš„ãªã€Œå…¬é–‹æ—¥ã€åˆ¶å¾¡å¯¾å¿œãƒ¡ãƒ¢
âœ… ç¾çŠ¶
è¡¨ç¤ºé †ã¯ structured_atï¼ˆæ§‹é€ åŒ–å®Œäº†æ—¥æ™‚ï¼‰ã§åˆ¶å¾¡

visible ãƒ•ã‚£ãƒ«ã‚¿ã¯æœªä½¿ç”¨ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆä¸­ï¼‰

ã€Œå…¬é–‹ãƒ»éå…¬é–‹ã€æ“ä½œã¯ä¸è¦ãªçŠ¶æ…‹ã§ã€ã™ã¹ã¦ã®è¨˜äº‹ãŒãã®ã¾ã¾è¡¨ç¤ºã•ã‚Œã‚‹ä»•æ§˜

ğŸ“Œ ä»Šå¾Œå¯¾å¿œã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹å†…å®¹
1. visible ã‚«ãƒ©ãƒ ã®æ´»ç”¨ï¼ˆè¨˜äº‹ã®å…¬é–‹ãƒ»éå…¬é–‹ç®¡ç†ï¼‰
ç®¡ç†ç”»é¢ã§ã®åˆ‡ã‚Šæ›¿ãˆæ“ä½œã§å¯¾å¿œäºˆå®š

ç¾åœ¨ .eq("visible", true) ã®ãƒ•ã‚£ãƒ«ã‚¿ã¯ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ

2. published_at ã‚«ãƒ©ãƒ ã®å°å…¥ï¼ˆè¡¨ç¤ºé †ã«ä½¿ã†æƒ³å®šï¼‰
structured_at ã§ã¯ãªãã€å…¬é–‹æ“ä½œã—ãŸæ—¥æ™‚ã‚’åŸºæº–ã«ã—ãŸã‚½ãƒ¼ãƒˆã‚’å®Ÿç¾ã™ã‚‹

å…¬é–‹æ“ä½œæ™‚ã« published_at = now() ã‚’è‡ªå‹•ä»˜ä¸ã™ã‚‹è¨­è¨ˆ

ts
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
query = query
  .eq("visible", true)                  // å…¬é–‹æ¸ˆã¿è¨˜äº‹ã®ã¿
  .order("published_at", { ascending: false }); // å…¬é–‹æ—¥ã®æ–°ã—ã„é †
3. ç®¡ç†UIã¸ã®æ‹¡å¼µ
å…¬é–‹ãƒœã‚¿ãƒ³ â†’ visible = true, published_at = now()

éå…¬é–‹ãƒœã‚¿ãƒ³ â†’ visible = false, published_at = null

ğŸ§ª ä»Šã¯ã©ã†ã™ã‚‹ï¼Ÿ
ã™ã¹ã¦ã®æ§‹é€ åŒ–æ¸ˆã¿è¨˜äº‹ãŒå³è¡¨ç¤ºå¯¾è±¡

visible / published_at ã¯è€ƒæ…®ã›ãšã«ä¸€è¦§åŒ–


â˜…â˜…
[âš  ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å¤‰æ›´å¾Œã®æ³¨æ„]
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®éƒ½é“åºœçœŒãªã©ã®å±æ€§ã‚’ç·¨é›†ãƒ»æ›´æ–°ã—ãŸå¾Œã€é·ç§»å…ˆã§ç¢ºå®Ÿã«åæ˜ ã•ã‚ŒãŸçŠ¶æ…‹ã§ãƒãƒƒãƒãƒ³ã‚°ã‚’è¡Œã†ãŸã‚ã€æ›´æ–°å®Œäº†å¾Œã®ãƒšãƒ¼ã‚¸é·ç§»æ™‚ã«ã¯ router.replace() ã‚‚ã—ãã¯ router.refresh() ã«ã‚ˆã‚‹å¼·åˆ¶çš„ãªå†èª­ã¿è¾¼ã¿ã‚’è¡Œã†ã“ã¨ã€‚

ã€ç†ç”±ã€‘
æ›´æ–°ãŒåæ˜ ã•ã‚Œã‚‹å‰ã«æ¬¡ãƒšãƒ¼ã‚¸ã¸é·ç§»ã™ã‚‹ã¨ã€å¤ã„ãƒ‡ãƒ¼ã‚¿çŠ¶æ…‹ã§ãƒãƒƒãƒãƒ³ã‚°ãŒè¡Œã‚ã‚Œã€å…¨ä»¶è¡¨ç¤ºãƒ»ãƒ•ã‚£ãƒ«ã‚¿æœªé©ç”¨ã®ä¸å…·åˆãŒç”Ÿã˜ã‚‹ãŸã‚ã€‚


ğŸ“˜ READMEï¼šNewsList è¡¨ç¤ºå®‰å®šåŒ–å¯¾å¿œï¼ˆ2025/05/10ï¼‰
ğŸ¯ ç›®çš„
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ãŠã„ã¦ã€åœ°åŸŸã«åŸºã¥ãè¨˜äº‹ã®ãƒãƒƒãƒãƒ³ã‚°è¡¨ç¤ºãŒåˆæœŸè¡¨ç¤ºæ™‚ã«å®‰å®šã—ãªã„å•é¡Œã®æ”¹å–„ã€‚ç‰¹ã«ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç™»éŒ²ç›´å¾Œã‚„ãƒšãƒ¼ã‚¸é·ç§»å¾Œã«**ã€Œå…¨ä»¶è¡¨ç¤ºã•ã‚Œã‚‹ã€ã€Œæ¡ä»¶ãŒåæ˜ ã•ã‚Œãªã„ã€**ãªã©ã®ä¸å…·åˆã‚’è§£æ¶ˆã™ã‚‹ã€‚

âœ… å®Ÿæ–½å†…å®¹ï¼ˆä¸»ã« NewsList.jsï¼‰
1. åœ°åŸŸï¼ˆéƒ½é“åºœçœŒï¼‰ã®å–å¾—ã¨è¨˜äº‹æ¤œç´¢ã‚’é€£æºã•ã›ã‚‹
å¾“æ¥ã¯ setArea() ã®å¾Œ useEffect() ã«ã‚ˆã‚Šå†æ¤œç´¢ã—ã¦ã„ãŸãŒã€ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®ã‚ºãƒ¬ã§æ¤œç´¢æ¡ä»¶ãŒåæ˜ ã•ã‚Œãªã„ã“ã¨ãŒã‚ã£ãŸã€‚

ä¿®æ­£å‰ï¼š

fetchArticles() å˜ç‹¬ã§ useEffect å†…éƒ¨ã§å®Ÿè¡Œ

area ãŒ useEffect ã®ä¾å­˜ã¨ã—ã¦æ¯å›ãƒˆãƒªã‚¬ãƒ¼

ä¿®æ­£å¾Œï¼š

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã® region_prefecture ã‚’ supabase çµŒç”±ã§å–å¾—ã—ã€fetchArticles(clientArea) ã‚’æ˜ç¤ºçš„ã«å®Ÿè¡Œ

setArea() ã‚‚åŒæ™‚ã«åæ˜ ã—ã€ä»–å‡¦ç†ã¨ã®æ•´åˆæ€§ã‚’ç¶­æŒ

useEffect ã®ä¾å­˜ã‹ã‚‰ area ã‚’é™¤å¤–ï¼ˆç„¡é™ãƒ«ãƒ¼ãƒ—ãƒ»äºŒé‡èª­ã¿è¾¼ã¿å›é¿ï¼‰

js
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
useEffect(() => {
  const fetchClientRegionAndArticles = async () => {
    const { data: { user } } = await supabase.auth.getUser();
    if (!user) return;

    const { data, error } = await supabase
      .from("clients")
      .select("region_prefecture")
      .eq("uid", user.id)
      .single();

    if (data?.region_prefecture) {
      setArea(data.region_prefecture);
      await fetchArticles(data.region_prefecture);
    }
  };

  fetchClientRegionAndArticles();
}, [page, keyword, sortBy, ascending]);
ğŸ”„ ãã®ä»–ã®æ”¹å–„äº‹é …
structured_prefecture ã«å¯¾ã—ã¦ [clientArea, "å…¨å›½"] ã‚’ãƒãƒƒãƒãƒ³ã‚°æ¡ä»¶ã¨ã—ã¦æ¤œç´¢

åœ°åŸŸãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ UI ã‹ã‚‰éè¡¨ç¤ºã¨ã—ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ­ã‚¸ãƒƒã‚¯ã§åˆ¶å¾¡ï¼ˆå°†æ¥ã€è¡¨ç¤ºå¾©æ´»ã‚‚æƒ³å®šï¼‰

åˆæœŸèª­ã¿è¾¼ã¿æ™‚ã®ä¸å®‰å®šã•è»½æ¸›

è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ã‚’ NewsList ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§å®Œçµ

ğŸ’¡ å°†æ¥çš„ãªæ”¹å–„ãƒ¡ãƒ¢ï¼ˆToDoï¼‰
visible ã‚«ãƒ©ãƒ ã«ã‚ˆã‚‹å…¬é–‹ãƒ•ãƒ©ã‚°åˆ¤å®šã®å°å…¥ï¼ˆç¾çŠ¶ã¯ä¸€æ™‚ç„¡åŠ¹ï¼‰

ã€Œå…¬é–‹æ—¥ã€ã‚«ãƒ©ãƒ è¿½åŠ ã«ã‚ˆã‚Šã€æ–°ç€é †ã‚’å®‰å®šåŒ–ï¼ˆç¾åœ¨ã¯æ§‹é€ åŒ–æ—¥æ™‚ã§ä»£ç”¨ï¼‰

æ¤œç´¢æ¡ä»¶ãŒåæ˜ ã•ã‚Œã‚‹ã¾ã§ã‚¹ãƒ”ãƒŠãƒ¼ã‚„ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å¼·åŒ–

ClientDashboard å´ã§ã®åˆæœŸãƒ­ãƒ¼ãƒ‰ã¨ã®é€£æºæ”¹å–„ï¼ˆãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«åæ˜ å¾Œã®ãƒªãƒ­ãƒ¼ãƒ‰åˆ¶å¾¡ãªã©ï¼‰

ğŸ—‚ é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
app/client-dashboard/page.js

app/client-dashboard/news-control/NewsList.js

lib/supabaseClient.js

supabase: clients.region_prefecture

