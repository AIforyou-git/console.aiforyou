âœ… å…¨ä½“æ§‹æˆï¼šç´¹ä»‹ç™»éŒ²ã‚·ã‚¹ãƒ†ãƒ ï¼ˆ2ç³»çµ±æ§‹æˆï¼‰
ğŸ§± ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦ï¼šç´¹ä»‹ç™»éŒ²ã®2ç³»çµ±æ§‹æˆ
åŒºåˆ†	ç™»éŒ²ãƒ«ãƒ¼ãƒˆ	ç™»éŒ²è€…	å½¹å‰²ã®æ±ºå®šæ–¹æ³•	ç‰¹å¾´
âœ… Adminç´¹ä»‹	ç®¡ç†ç”»é¢ã‹ã‚‰ç›´æ¥ä½œæˆ	Adminæœ¬äºº	ãƒ•ã‚©ãƒ¼ãƒ ã§æŒ‡å®š (role, email)	ç®¡ç†æ¨©é™ã§ä»»æ„ã®ãƒ­ãƒ¼ãƒ«ã‚’ç›´æ¥ç™»éŒ²
âœ… ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç´¹ä»‹	ç´¹ä»‹ãƒªãƒ³ã‚¯ï¼ˆä¾‹: /signup-client?ref=...ï¼‰	ã‚¨ãƒ³ãƒ‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æœ¬äºº	referredBy ã‚’è§£æã—ã¦ clientå›ºå®š	ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ã‚’ãƒ™ãƒ¼ã‚¹ã«è‡ªå·±ç™»éŒ²ã™ã‚‹æµã‚Œ
ğŸ”· 1. Adminç´¹ä»‹ãƒ«ãƒ¼ãƒˆï¼ˆæ‰‹å‹•æ‹›å¾…ï¼‰
ğŸ“Œ ä¸»ãªå‡¦ç†ã®æµã‚Œ
pgsql
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
[Admin UI] â†’ [POST: /api/admin/create-user]
               â†“
         Firebase Authï¼ˆAdmin SDKï¼‰
               â†“
       Firestore "users" ã«ç™»éŒ²
ğŸ”¹ ç™»éŒ²ç”»é¢ï¼ˆUIï¼‰
app/admin-dashboard/users/create/page.jsâ€‹

ç®¡ç†è€…ãŒãƒ¡ãƒ¼ãƒ«ãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ»ãƒ­ãƒ¼ãƒ«ã‚’å…¥åŠ›

ç¾åœ¨ã¯ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ Firebase SDK ã‚’ä½¿ã£ã¦ç™»éŒ²ã—ã¦ã„ã‚‹ â† âš ï¸å°†æ¥çš„ã«ã‚µãƒ¼ãƒãƒ¼APIã«å¯„ã›ã‚‹ã¨å®‰å…¨

ğŸ”¹ ç™»éŒ²API
app/api/admin/create-user/route.jsâ€‹

Firebase Admin SDK ã‚’ä½¿ã£ã¦ç™»éŒ²

ä»®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã€Auth + Firestore ã«ä¸€æ‹¬ç™»éŒ²

referredBy: "admin"ã€status: "pending"

ğŸ”· 2. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç´¹ä»‹ãƒ«ãƒ¼ãƒˆï¼ˆè‡ªå·±ç™»éŒ²ï¼‰
ğŸ“Œ ä¸»ãªå‡¦ç†ã®æµã‚Œ
perl
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
[ç´¹ä»‹ãƒªãƒ³ã‚¯: /signup-client?ref=CQ-CLIENT-xxxxxx]
   â†“
[signup-client UI] â†’ [POST: /api/auth/register-user]
                         â†“
                Firebase Authï¼ˆClient SDKï¼‰
                         â†“
             Firestore "users" ã«ç™»éŒ²
                         â†“
             send-email ã§ä»®ãƒ‘ã‚¹é€ä¿¡
                         â†“
        Supabase ã¸åŒæœŸï¼ˆéåŒæœŸå‡¦ç†ï¼‰
ğŸ”¹ ç™»éŒ²ç”»é¢ï¼ˆUIï¼‰
app/signup-client/SignupClientPageClient.jsâ€‹

ref ã‚¯ã‚¨ãƒªã§ã‚¢ã‚¯ã‚»ã‚¹ â†’ ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ã‚’ /api/auth/check-referral ã§æ¤œè¨¼

ãƒ¡ãƒ¼ãƒ«ã‚’å…¥åŠ›ã—ã¦ç™»éŒ²ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™

ğŸ”¹ ç™»éŒ²API
app/api/auth/register-user/route.jsâ€‹

createUserWithEmailAndPassword() ã‚’ä½¿ç”¨ï¼ˆâš ï¸ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆSDKï¼‰

Firestoreã« role: "client"ã€referredBy æŠ½å‡ºã—ã¦ç™»éŒ²

/api/auth/send-email ã§ä»®ãƒ‘ã‚¹é€ä¿¡ï¼ˆâ€‹ï¼‰

ğŸ”¹ ä»˜éšå‡¦ç†
Supabase ã«éåŒæœŸã§åŒæœŸå‡¦ç†ã‚ã‚Šï¼ˆå¤±æ•—ã—ã¦ã‚‚å½±éŸ¿ãªã—ï¼‰

ğŸ“© ä»®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ãƒ¡ãƒ¼ãƒ«é€ä¿¡
ãƒ«ãƒ¼ãƒˆï¼š/api/auth/send-emailâ€‹

SMTPè¨­å®šã‚’ç”¨ã„ã¦ä»®ãƒ‘ã‚¹ã‚’é€šçŸ¥

æœ¬ç•ªãƒ‰ãƒ¡ã‚¤ãƒ³ (https://console.aiforyou.jp) ã‚’åˆ©ç”¨

ğŸ—ƒ Firestoreç™»éŒ²æƒ…å ±ã®å…±é€šæ§‹æˆ
ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å	èª¬æ˜
uid	Firebase Authã§ç™ºè¡Œã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ID
email	å…¥åŠ›ã•ã‚ŒãŸãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
role	adminæŒ‡å®š or ç´¹ä»‹å…ƒã«ã‚ˆã‚Šæ±ºå®š
referredBy	"admin" ã¾ãŸã¯ CQ-CLIENT-xxxxx ç­‰
status	åˆæœŸã¯ "pending"ï¼ˆãƒ­ã‚°ã‚¤ãƒ³å¾Œ "active" ã«å¤‰æ›´ï¼‰
createdAt	ç™»éŒ²æ—¥æ™‚
lastLogin	åˆæœŸã¯nullã€ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸã§æ›´æ–°
ğŸ§  è£œè¶³ï¼šå…±é€šåŒ– or åˆ†é›¢ã®è€ƒãˆæ–¹
æ–¹é‡	è©•ä¾¡	ç†ç”±
adminç´¹ä»‹ & ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç´¹ä»‹ã‚’åˆ†é›¢	âœ… æ­£è§£	èµ·ç‚¹ã‚‚åˆ¶å¾¡ç¯„å›²ã‚‚å…¨ãç•°ãªã‚‹ã€‚çµ±åˆã¯é€†ã«ãƒªã‚¹ã‚¯
Firestoreæ§‹é€ ã‚’å…±é€šåŒ–	âœ… è‰¯æ§‹æˆ	role, referredBy, status ã§ä¸€å…ƒç®¡ç†ã§ãã‚‹
èªè¨¼ãƒ»é€ä¿¡ãªã©ã®APIã‚’å†åˆ©ç”¨	âœ… åŠ¹ç‡çš„	send-email ãªã©ã¯å…±é€šã§ä½¿ãˆã‚‹
âœ… çµè«–ï¼šç¾åœ¨ã®å…¨ä½“æ§‹æˆã¯ã€Œ2ç³»çµ±ã®ç´¹ä»‹ç™»éŒ²ã‚’ä¸¡ç«‹ã—ã¤ã¤ã€å…±é€šæ§‹é€ ã§çµ±ä¸€ã•ã‚Œã¦ã„ã‚‹ã€çŠ¶æ…‹
ç´¹ä»‹å…ƒã«ã‚ˆã£ã¦åˆ†å²ã—ãŸç™»éŒ²ãƒ«ãƒ¼ãƒˆ

Firestoreã®æ§‹æˆã¯çµ±ä¸€ã•ã‚Œã¦ã„ã‚‹ãŸã‚ç®¡ç†ã—ã‚„ã™ã„

å®‰å…¨æ€§ã®è¦³ç‚¹ã§ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆSDKä½¿ç”¨éƒ¨åˆ†ãŒèª²é¡Œï¼ˆ= register-user ã®æ”¹å–„ä½™åœ°ï¼‰

æ¬¡ã«é€²ã‚€å€™è£œã¨ã—ã¦ï¼š

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç´¹ä»‹ã® register-user ã‚’å®‰å…¨åŒ–ã™ã‚‹ã‹ï¼ˆAdmin SDKåŒ–ï¼‰

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç´¹ä»‹ã‚³ãƒ¼ãƒ‰ã®ç²¾åº¦ï¼ˆcheck-referralï¼‰ã®å®Ÿè£…ç¢ºèª

UI/UXæ”¹å–„ or ãƒ­ãƒ¼ãƒ«æ¯ã®åˆæœŸè¨­å®šï¼ˆprofileCompletedãªã©ï¼‰ã®è‡ªå‹•ä»˜ä¸æ•´ç†